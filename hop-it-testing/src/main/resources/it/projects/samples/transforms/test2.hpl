<?xml version="1.0" encoding="UTF-8"?>
<pipeline>
  <info>
    <name>test2</name>
    <name_sync_with_filename>Y</name_sync_with_filename>
    <description/>
    <extended_description/>
    <pipeline_version/>
    <pipeline_type>Normal</pipeline_type>
    <parameters>
      <parameter>
        <name>ID_KEYS</name>
        <default_value/>
        <description/>
      </parameter>
    </parameters>
    <capture_transform_performance>N</capture_transform_performance>
    <transform_performance_capturing_delay>1000</transform_performance_capturing_delay>
    <transform_performance_capturing_size_limit>100</transform_performance_capturing_size_limit>
    <created_user>-</created_user>
    <created_date>2022/01/04 17:32:26.545</created_date>
    <modified_user>-</modified_user>
    <modified_date>2022/01/04 17:32:26.545</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
  </notepads>
  <order>
    <hop>
      <from>读取变更事件</from>
      <to>查询-LC_ShareTransfer</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>查询-LC_ShareTransfer</from>
      <to>TransMode=11</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>TransMode=11</from>
      <to>结束-TransMode</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>读取变更事件</from>
      <to>删除STK_BGDL</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>TransMode=11</from>
      <to>更新STK_BGDL</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <transform>
    <name>TransMode=11</name>
    <type>SwitchCase</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <cases>
      <case>
        <target_transform>更新STK_BGDL</target_transform>
        <value>1</value>
      </case>
    </cases>
    <case_value_type>Integer</case_value_type>
    <default_target_transform>结束-TransMode</default_target_transform>
    <fieldname>FLAG</fieldname>
    <use_contains>N</use_contains>
    <attributes/>
    <GUI>
      <xloc>368</xloc>
      <yloc>272</yloc>
    </GUI>
  </transform>
  <transform>
    <name>删除STK_BGDL</name>
    <type>Delete</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <commit>100</commit>
    <connection>CBD</connection>
    <lookup>
      <key>
        <condition>=</condition>
        <field>SOURCE_ID</field>
        <name>id</name>
      </key>
      <table>STK_BGDL</table>
    </lookup>
    <attributes/>
    <GUI>
      <xloc>368</xloc>
      <yloc>144</yloc>
    </GUI>
  </transform>
  <transform>
    <name>更新STK_BGDL</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>CBD</connection>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema/>
      <table>STK_BGDL</table>
      <key>
        <name>SOURCE_ID</name>
        <field>SOURCE_ID</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>BUYER_BRANCH_ID</name>
        <rename>BUYER_BRANCH_ID</rename>
        <update>Y</update>
      </value>
      <value>
        <name>BUYER_BRANCH_NAME</name>
        <rename>BUYER_BRANCH_NAME</rename>
        <update>Y</update>
      </value>
      <value>
        <name>CRRC_CD</name>
        <rename>CRRC_CD</rename>
        <update>Y</update>
      </value>
      <value>
        <name>INFO_SRC</name>
        <rename>INFO_SRC</rename>
        <update>Y</update>
      </value>
      <value>
        <name>IS_DELETE</name>
        <rename>IS_DELETE</rename>
        <update>Y</update>
      </value>
      <value>
        <name>IS_SPCL</name>
        <rename>IS_SPCL</rename>
        <update>Y</update>
      </value>
      <value>
        <name>MTCH_PRC</name>
        <rename>MTCH_PRC</rename>
        <update>Y</update>
      </value>
      <value>
        <name>PUB_DT</name>
        <rename>PUB_DT</rename>
        <update>Y</update>
      </value>
      <value>
        <name>SECU_ID</name>
        <rename>SECU_ID_S</rename>
        <update>Y</update>
      </value>
      <value>
        <name>SLER_BRANCH_ID</name>
        <rename>SLER_BRANCH_ID</rename>
        <update>Y</update>
      </value>
      <value>
        <name>SLER_BRANCH_NAME</name>
        <rename>SLER_BRANCH_NAME</rename>
        <update>Y</update>
      </value>
      <value>
        <name>SOURCE_ID</name>
        <rename>SOURCE_ID</rename>
        <update>N</update>
      </value>
      <value>
        <name>SOURCE_TYP</name>
        <rename>SOURCE_TYP</rename>
        <update>Y</update>
      </value>
      <value>
        <name>TRD_AMT</name>
        <rename>TRD_AMT</rename>
        <update>Y</update>
      </value>
      <value>
        <name>TRD_DT</name>
        <rename>TRD_DT</rename>
        <update>Y</update>
      </value>
      <value>
        <name>TRD_VOL</name>
        <rename>TRD_VOL</rename>
        <update>Y</update>
      </value>
      <value>
        <name>ID</name>
        <rename>id</rename>
        <update>Y</update>
      </value>
    </lookup>
    <attributes/>
    <GUI>
      <xloc>368</xloc>
      <yloc>672</yloc>
    </GUI>
  </transform>
  <transform>
    <name>查询-LC_ShareTransfer</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>JY</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT concat('S_JY_',A.InnerCode)      AS SECU_ID_S, -- 证券编号
      A.InfoPublDate   AS TRD_DT, -- 交易日期
      A.InfoSource     AS INFO_SRC, -- 信息来源
      A.InfoPublDate   AS PUB_DT, -- 发布日期
      -- A.               AS EXCH_CD, -- 交易所代码
      -- A.               AS SEQ, -- 序号
      A.DealPrice      AS MTCH_PRC, -- 成交价格
      A.InvolvedSum    AS TRD_VOL, -- 成交量
      A.DealTurnover   AS TRD_AMT, -- 成交金额
      10156            AS CRRC_CD, -- 货币代码
      A.ReceiverName   AS BUYER_BRANCH_NAME, -- 买方营业部名称
      concat(a.innercode,a.ReceiverName) AS BUYER_BRANCH_ID, -- 买方营业部编号
      A.TransfererName AS SLER_BRANCH_NAME, -- 卖方营业部名称
      concat(a.innercode,a.TransfererName)             AS SLER_BRANCH_ID, -- 卖方营业部编号
      CASE WHEN A.IfSPBlockTrade='否' THEN 0 ELSE 1 END AS IS_SPCL, -- 是否专场
      b.secucategory,b.SecuMarket,
      '07.605602370'   AS SOURCE_TYP, -- 来源标识
      CAST(A.ID AS CHAR) AS SOURCE_ID, -- 来源记录编号
      CASE WHEN A.TranMode=11 THEN 1 ELSE 0 END AS FLAG ,
      '0'               AS IS_DELETE -- 删除标识
      FROM LC_ShareTransfer A
      JOIN secumain B ON A.InnerCode=B.INNERCODE
      WHERE  A.ID= ?</sql>
    <outer_join>N</outer_join>
    <replace_vars>N</replace_vars>
    <parameter>
      <field>
        <name>id</name>
        <type>Integer</type>
      </field>
    </parameter>
    <attributes/>
    <GUI>
      <xloc>128</xloc>
      <yloc>272</yloc>
    </GUI>
  </transform>
  <transform>
    <name>结束-TransMode</name>
    <type>Dummy</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <attributes/>
    <GUI>
      <xloc>592</xloc>
      <yloc>272</yloc>
    </GUI>
  </transform>
  <transform>
    <name>读取变更事件</name>
    <type>RowInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>JY</connection>
    <delete_flow>删除STK_BGDL</delete_flow>
    <update_flow>查询-LC_ShareTransfer</update_flow>
    <ignore_delete>Y</ignore_delete>
    <keys>
      <field>
        <name>id</name>
        <type>Integer</type>
      </field>
    </keys>
    <row_limit>100</row_limit>
    <show_all_fields>N</show_all_fields>
    <table>LC_ShareTransfer</table>
    <attributes/>
    <GUI>
      <xloc>128</xloc>
      <yloc>144</yloc>
    </GUI>
  </transform>
  <transform_error_handling>
  </transform_error_handling>
  <attributes/>
</pipeline>
